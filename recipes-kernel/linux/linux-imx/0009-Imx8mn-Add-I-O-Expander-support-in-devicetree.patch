From 835f181acbf4eb8d38a1fb7a530e351265dc0f94 Mon Sep 17 00:00:00 2001
From: Alvaro-solidrun <alvaro.karsz@solid-run.com>
Date: Wed, 2 Jun 2021 16:23:21 +0300
Subject: [PATCH] Imx8mn - Add I/O Expander support in devicetree

---
 .../boot/dts/freescale/imx8mn-compact.dts     | 33 ++++++++++++-------
 1 file changed, 21 insertions(+), 12 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/imx8mn-compact.dts b/arch/arm64/boot/dts/freescale/imx8mn-compact.dts
index 11adc46d645d..9fba2482b933 100755
--- a/arch/arm64/boot/dts/freescale/imx8mn-compact.dts
+++ b/arch/arm64/boot/dts/freescale/imx8mn-compact.dts
@@ -133,12 +133,6 @@
 		>;
 	};
 
-	pinctrl_gpio_led: gpioledgrp {
-		fsl,pins = <
-			MX8MN_IOMUXC_NAND_READY_B_GPIO3_IO16	0x19
-		>;
-	};
-
 	pinctrl_gpio_wlf: gpiowlfgrp {
 		fsl,pins = <
 			MX8MN_IOMUXC_I2C4_SDA_GPIO5_IO21	0xd6
@@ -173,6 +167,14 @@
 		>;
 	};
 
+        pinctrl_io_expander: i2c3-io-expander {
+                fsl,pins = <
+                        MX8MN_IOMUXC_SD1_STROBE_GPIO2_IO11              0x1d1 /* iomux interrupt */
+                        MX8MN_IOMUXC_NAND_READY_B_GPIO3_IO16            0x191 /* iomux reset */
+                >;
+        };
+
+
 	pinctrl_i2c2_synaptics_dsx_io: synaptics_dsx_iogrp {
 		fsl,pins = <
 			MX8MN_IOMUXC_GPIO1_IO09_GPIO1_IO9		0x19
@@ -446,12 +448,19 @@
 	sda-gpios = <&gpio5 19 GPIO_ACTIVE_HIGH>;
 	status = "okay";
 
-	pca6416: gpio@20 {
-		compatible = "ti,tca6416";
-		reg = <0x20>;
-		gpio-controller;
-		#gpio-cells = <2>;
-	};
+        io_expander: gpio-controller@20 {
+                compatible = "ti,tca6408";
+                reg = <0x20>;
+                pinctrl-names = "default";
+                pinctrl-0 = <&pinctrl_io_expander>;
+                interrupt-controller;
+                #interrupt-cells = <2>;
+                reset-gpios = <&gpio3 16 GPIO_ACTIVE_LOW>;
+                gpio-controller;
+                #gpio-cells = <2>;
+                interrupt-parent = <&gpio2>;
+                interrupts = <11 IRQ_TYPE_EDGE_FALLING>;
+        };
 
 	rtc@69 {
 		compatible = "abracon,ab1805";
-- 
2.25.1

